\documentclass[main.tex]{subfiles}
\begin{document}

\chapter{Background}
%------------------
\section{Modeling Mechanical Systems}
\section{Lagrangian Mechanics}
\begin{boxdef}{Smooth Simple Mechanical System \cite{mccarthy}}
A set $\del{Q,\mathbb{G},P}$, where
\begin{enumerate}[i.]
    \item $Q$ is a smooth manifold called the configuration manifold. This is the manifold whose points consist of all possible coordinate configurations of the system.
    \item $\mathbb{G}$ is a smooth Riemannian metric on $Q$ called the kinetic energy metric, typically defined as $\mathbb{G}(q,\dot q)=\frac{1}{2}\dot q^T D(q) \dot q$.
    \item $P$ is a smooth potential function on $Q$.
\end{enumerate}
\end{boxdef}
In Lagrangian mechanics, a system can be modelled using generalized coordinates $q_i\in Q$. Spatial coordinates $x_i\in\mathbb{R}^n$ can be transformed $x_i\mapsto q_i$ using a chart. 



\subsection{Holonomic constraints}
A system may be subject to mechanical constraints which restrict its position or velocity through space. 

\textbf{Holonomic contraints} are one type of constraint which acts the spatial coordinates of a system. One such example could be a point particle, restricted to the surface of a sphere with radius $R$. Subject to this restriction, the point's spatial coordinates $P(x,y,z)$ are required to satisfy
\begin{align}
    x^2+y^2+z^2=R^2.
\end{align}
This is an example of a holonomic constraint, because we are able to define the constraint as a uniformly homogeneous function of the spatial coordinates (and time):
\begin{align}
    h(x,y,z,t):=x^2+y^2+z^2-R^2\equiv 0.
\end{align}

On the other hand, constraining the particle to the \textit{interior} of the sphere would be an example of a \textbf{non-holomic constraint} since the constraint cannot be expressed as a uniformly homogeneous function.
\begin{align}
    x^2+y^2+z^2<R^2 \implies h(x,y,z,t):=x^2+y^2+z^2-R^2<0\qq{and therefore}\neq 0.
\end{align}


In this study, we are especially interested in artificially imposing holonomic constraints on mechanical systems by means of control. \textbf{Virtual holonomic constraints}, as they are called, are not physical constraints on the system. Only when the controller acts on the system's actuators, might the system appear to be subject to holonomic constraints. As a practical example, this could look like constraining the joint angles on a group of several identical robots such that they all walk in formation\cite{maggiore2012virtual}. Virtual holonomic constraints are discussed in more detail in Section \ref{vhc-section}.


\subsection{Symmetry}
\begin{boxdef}{Symmetry \cite[291]{bullo2019geometric}%
}
Let $\del{Q,\mbbg,P}$ be a smooth simple mechanical system. \begin{enumerate}[i.]
    \item A smooth left action $\Phi$ of a Lie group $G$ on $Q$ is a \textbf{symmetry} of the system if $\Phi$ is an isometry and $P$ is $\Phi$-invariant.
    \item A smooth vector field $X$ on $Q$ is an \textbf{infinitesimal symmetry} of the system is $X$ is an infinitesimal isometry, and $P$ is $X$-invariant.
\end{enumerate}
\end{boxdef}

\begin{boxthm}{Noether's theorem\cite[292]{bullo2019geometric}%
}
Let $\del{Q,\mbbg,P}$ be a smooth simple mechanical system, and let $\gamma:I\to Q$ be a solution to its equations of motion. Then
\begin{enumerate}[i.]
    \item 
    \item 
\end{enumerate}
\end{boxthm}


\subsection{Dynamical Reduction}
\section{Control Theory}

        degrees of freedom, actuation
\subsection{Virtual Holonomic Contraints (revisited)}\label{vhc-section}
Maggiore and Consolini provide a formal definition for VHCs, as well as an overview of the conditions under which they can be imposed\cite{maggiore2012virtual}.

\begin{boxdef}{Virtual Holonomic Constraint \cite{maggiore2012virtual}}
For a smooth simple mechanical control system $\del{Q,\mbbg,P,\cbr{F_i}}$\todo{define control system above and check this}, a virtual holonomic constraint of order $k$ is a smooth relation $h:Q\to\ree^k$,
$h(q)=\vec{0}$, and for all $q\in h\inv(0),$ and the constraint manifold
\begin{align}
    \Gamma=\cbr{(q,\qd):h(q)=0,\dd h_q\qd=0}
\end{align}
is controlled invariant. That means, there exists a smooth feedback $\tau(q,\qd)$ that enforces the constraint, such that $\Gamma$ is (asymptotically) invariant.
\end{boxdef}
\begin{boxthm}{Conditions for regular VHCs \cite{maggiore2012virtual}}
Let $h:Q\to\ree^4$ be smooth, $\rank \dd h_q=k$ for all $q\in h\inv(0).$ Then $h(q)$ is a \textbf{regular VHC of order $k$} if and only if $\forall q\in h\inv(0),$
\begin{align}
     \dim\sbr{Im(D\inv(q)B(q))\cap Ker(\dd h_q)}=n-1-k.
\end{align}
\end{boxthm}\label{thm:regularvhc}

\section{Modelling a Simple Mechanical Control System}\todo[color=blue]{think about what section this fits best into}
\subsection{General Equation}
Putting all the pieces together, a generalized differential equation for a simple mechanical control system is given by:
\begin{align}
    D\del{\vec q}\vec\qdd+C\del{\vec q,\vec\qd}\vec\qd+\vec\nabla_qP\del{\vec q}=B\vec\tau\label{control-equation}
\end{align}
where each variable is defined as follows:\todo{I want to add what type of mathematical object each variable is}
\begin{itemize}
    \item $\vec q, \vec \qd, \vec \qdd$ are the generalized coordinates of the system, and the respective first and second time derivatives thereof.
    \item $D(q)$ (also known as $M(q)$) is the inertia matrix.
    \item $C\del{q,\qd}$ is the Coriolis matrix.\todo{explain this more}
    \item $P\del{\vec q}$ is a scalar function\todo{check this, I think it's a 1-form} whose gradient with respect to the generalized coordinates describes the potential field of the system.
    \item $B$ is a $\del{\dim \vec q }\cross\del{ \dim \vec\tau}$ matrix, which relates the degrees of freedom of the system to the number of control inputs. For example, if the system is characterized by 4 generalized coordinates and 2 actuators, $B\in M_{4\cross 2}\del{\ree}$.
    \item $\vec \tau$ (also known as $\vec u$) is the set of control inputs of the system.
\end{itemize}
Constraints are expressed as a vector function, $\vec{h}(\vec q)$,
    \begin{align}
        \vec{h}(\vec q)&=\pmqty{h_1(\vec q)\\h_2(\vec q)\\\vdots}\equiv \vec 0
    \end{align}
    Since the goal is to drive the holonomic constraints to zero through control, it makes sense to define the Error as the contraint $\vec e(\vec q):=\vec h(\vec q)$. With this, we get:\todo[color=blue]{multi col format}
    \begin{align}
        \vec{e}&=\vec h(\vec q);\\
    \dot{\vec{e}}&=\dv{}{t}\vec h(\vec q)\\&=\dd \vec{h}(\vec{q})\dot{\vec{q}};\\
    \ddot{\vec{e}}&=\dv{}{t}\del{\dd {\vec{h}(\vec{q})}\dot{\vec{q}}}\\
    &=\dot{\vec{q}}^\top\del{\pdv{}{\vec q}\grad_q{\vec{h}(\vec{q})}}\dot{\vec{q}}+\dd {\vec{h}(\vec{q})}\ddot{\vec{q}}.\label{eq:edd}
    \end{align}
    Where we define $\dd$ as the Jacobian operator, whose $ij$\textsuperscript{th} matrix element is:
    \begin{align}
        \sbr{\dd \vec f}_{ij}=\pdv{}{q_j}\del{\vec f\cdot\hat{e}_i}
    \end{align}
    By isolating for $\ddot{\vec q}$ in Equation \ref{eq:edd}, we can set $\ddot{\vec{e}}$ as a function of our control, $\vec\tau$. Then, we can choose the control, $\vec\tau$, so that it causes $\ddot{\vec{e}}\to \vec{0}$. Starting from Equation \ref{control-equation},
    \begin{align}
        \ddot{\vec{q}}=D\inv(\vec{q})\del{B\vec{\tau}
        -C\del[1]{\vec q,\vec\qd}\vec\qd-\vec\nabla_qP\del{\vec q}}.\label{eq:qdd}
    \end{align}
    Substitute Equation \ref{eq:qdd} into Equation \ref{eq:edd}), and assuming that $\ddot{\vec{e}}$ is driven to zero, we can isolate for $\vec{\tau}$ to obtain the \textbf{Control law}:
    \begin{align}
        \vec{\tau}=
        
    \end{align}
\subsection{Example: Modeling $X$ System}
In this section, we will demonstrate how Equation \ref{control-equation} applies to a specific example.
\begin{enumerate}[(1)]
    \item A system is chosen, along with a suitable coordinate system such that the system is endowed with symmetries in the coordinates.
    \item ...
    \item 
\end{enumerate}
\end{document}